#!/bin/sh

CUSTOM_PROMPTS_CHANGED=false
RULES_CHANGED=false

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’ãƒã‚§ãƒƒã‚¯
git diff --cached --name-only | while read file; do
    if echo "$file" | grep "^ai-instructions/custom-prompts/" > /dev/null; then
        CUSTOM_PROMPTS_CHANGED=true
    elif echo "$file" | grep "^ai-instructions/rules/" > /dev/null; then
        RULES_CHANGED=true
    fi
done

# custom-promptsã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆ
if [ "$CUSTOM_PROMPTS_CHANGED" = true ]; then
    echo "ğŸ“ ai-instructions/custom-promptså†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚gen:instructions:custom-promptsã‚’å®Ÿè¡Œã—ã¾ã™..."
    npm run gen:instructions:custom-prompts || exit 1
    git add .roomodes .github/prompts
    echo "âœ… gen:instructions:custom-promptsã®å®Ÿè¡ŒãŒå®Œäº†ã—ã€ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«è¿½åŠ ã—ã¾ã—ãŸ"
fi

# rulesã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆ
if [ "$RULES_CHANGED" = true ]; then
    echo "ğŸ“ ai-instructions/ruleså†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚gen:instructions:rulesã‚’å®Ÿè¡Œã—ã¾ã™..."
    npm run gen:instructions:rules || exit 1
    git add .roorules .github/copilot-instructions.md .cursor/rules
    echo "âœ… gen:instructions:rulesã®å®Ÿè¡ŒãŒå®Œäº†ã—ã€ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«è¿½åŠ ã—ã¾ã—ãŸ"
fi

exit 0